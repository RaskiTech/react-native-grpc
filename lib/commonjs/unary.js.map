{"version":3,"sources":["unary.ts"],"names":["GrpcUnaryCall","constructor","method","data","requestHeaders","headers","response","trailers","abort","request","then","onfulfilled","onrejected","completedPromise","value","Promise","resolve","reason","reject","cancel","all","status"],"mappings":";;;;;;;;;;;;;;;AAGO,MAAMA,aAAN,CAAmE;AAUxEC,EAAAA,WAAW,CACTC,MADS,EAETC,IAFS,EAGTC,cAHS,EAITC,OAJS,EAKTC,QALS,EAMTC,QANS,EAOTC,KAPS,EAQT;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AACA,SAAKN,MAAL,GAAcA,MAAd;AACA,SAAKO,OAAL,GAAeN,IAAf;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKC,QAAL,GAAgBA,QAAhB;;AACA,wCAAcC,KAAd;AACD;;AAEDE,EAAAA,IAAI,CACFC,WADE,EAIFC,UAJE,EAKgC;AAClC,WAAO,KAAKC,gBAAL,GAAwBH,IAAxB,CACJI,KAAD,IACEH,WAAW,GACPI,OAAO,CAACC,OAAR,CAAgBL,WAAW,CAACG,KAAD,CAA3B,CADO,GAENA,KAJF,EAKJG,MAAD,IACEL,UAAU,GACNG,OAAO,CAACC,OAAR,CAAgBJ,UAAU,CAACK,MAAD,CAA1B,CADM,GAENF,OAAO,CAACG,MAAR,CAAeD,MAAf,CARD,CAAP;AAUD;;AAEDE,EAAAA,MAAM,GAAG;AACP,wCAAYX,KAAZ;AACD;;AAED,QAAcK,gBAAd,GAAkE;AAChE,UAAM,CAACR,OAAD,EAAUC,QAAV,EAAoBC,QAApB,IAAgC,MAAMQ,OAAO,CAACK,GAAR,CAAY,CACtD,KAAKf,OADiD,EAEtD,KAAKC,QAFiD,EAGtD,KAAKC,QAHiD,CAAZ,CAA5C;AAMA,WAAO;AACLL,MAAAA,MAAM,EAAE,KAAKA,MADR;AAELE,MAAAA,cAAc,EAAE,KAAKA,cAFhB;AAGLK,MAAAA,OAAO,EAAE,KAAKA,OAHT;AAILJ,MAAAA,OAJK;AAKLE,MAAAA,QALK;AAMLD,MAAAA,QAAQ,EAAEA,QANL;AAOLe,MAAAA,MAAM,EAAE;AAPH,KAAP;AASD;;AAlEuE","sourcesContent":["import { AbortController } from 'abort-controller';\nimport { CompletedGrpcUnaryCall, GrpcMetadata } from './types';\n\nexport class GrpcUnaryCall implements PromiseLike<CompletedGrpcUnaryCall> {\n  readonly method: string;\n  readonly requestHeaders: GrpcMetadata;\n  readonly request: Uint8Array;\n  readonly headers: Promise<GrpcMetadata>;\n  readonly response: Promise<Uint8Array>;\n  readonly trailers: Promise<GrpcMetadata>;\n\n  #abort: AbortController;\n\n  constructor(\n    method: string,\n    data: Uint8Array,\n    requestHeaders: GrpcMetadata,\n    headers: Promise<GrpcMetadata>,\n    response: Promise<Uint8Array>,\n    trailers: Promise<GrpcMetadata>,\n    abort: AbortController\n  ) {\n    this.method = method;\n    this.request = data;\n    this.requestHeaders = requestHeaders;\n    this.headers = headers;\n    this.response = response;\n    this.trailers = trailers;\n    this.#abort = abort;\n  }\n\n  then<TResult1 = CompletedGrpcUnaryCall, TResult2 = unknown>(\n    onfulfilled?:\n      | ((value: CompletedGrpcUnaryCall) => TResult1 | PromiseLike<TResult1>)\n      | null,\n    onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | null\n  ): PromiseLike<TResult1 | TResult2> {\n    return this.completedPromise().then(\n      (value) =>\n        onfulfilled\n          ? Promise.resolve(onfulfilled(value))\n          : (value as unknown as TResult1),\n      (reason) =>\n        onrejected\n          ? Promise.resolve(onrejected(reason))\n          : Promise.reject(reason)\n    );\n  }\n\n  cancel() {\n    this.#abort.abort();\n  }\n\n  private async completedPromise(): Promise<CompletedGrpcUnaryCall> {\n    const [headers, response, trailers] = await Promise.all([\n      this.headers,\n      this.response,\n      this.trailers,\n    ]);\n\n    return {\n      method: this.method,\n      requestHeaders: this.requestHeaders,\n      request: this.request,\n      headers,\n      trailers,\n      response: response,\n      status: 0,\n    };\n  }\n}\n"]}